<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartment Hunter Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg-primary:#0a0a0b;--bg-secondary:#141416;--bg-tertiary:#1c1c1f;--bg-hover:#242428;--border:#2a2a2e;--text-primary:#fafafa;--text-secondary:#a1a1aa;--text-muted:#71717a;--accent:#3b82f6;--accent-hover:#2563eb;--success:#22c55e;--success-bg:rgba(34,197,94,0.1);--warning:#f59e0b;--warning-bg:rgba(245,158,11,0.1);--danger:#ef4444;--danger-bg:rgba(239,68,68,0.1);--purple:#a855f7}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.5}.app{display:flex;min-height:100vh}.sidebar{width:280px;background:var(--bg-secondary);border-right:1px solid var(--border);padding:24px;position:fixed;height:100vh;overflow-y:auto}.main{flex:1;margin-left:280px;padding:24px 32px}.logo{display:flex;align-items:center;gap:12px;margin-bottom:32px}.logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--accent),var(--purple));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px}.logo-text{font-size:18px;font-weight:700}.logo-text span{color:var(--text-muted);font-weight:400;font-size:12px;display:block}.sidebar-section{margin-bottom:28px}.sidebar-title{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-muted);margin-bottom:12px}.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}.stat-card{background:var(--bg-tertiary);border-radius:10px;padding:14px;text-align:center}.stat-value{font-size:24px;font-weight:700;color:var(--accent)}.stat-value.success{color:var(--success)}.stat-value.warning{color:var(--warning)}.stat-value.purple{color:var(--purple)}.stat-label{font-size:11px;color:var(--text-muted);margin-top:4px}.form-group{margin-bottom:16px}.form-label{display:block;font-size:13px;font-weight:500;color:var(--text-secondary);margin-bottom:6px}.form-input,.form-select{width:100%;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--text-primary);font-size:14px;transition:border-color 0.2s}.form-input:focus,.form-select:focus{outline:none;border-color:var(--accent)}.form-row{display:flex;gap:12px}.form-row .form-group{flex:1}.checkbox-list{display:flex;flex-direction:column;gap:8px}.checkbox-item{display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--bg-tertiary);border-radius:6px;cursor:pointer;transition:background 0.2s}.checkbox-item:hover{background:var(--bg-hover)}.checkbox-item input{width:16px;height:16px;accent-color:var(--accent)}.checkbox-item label{font-size:13px;cursor:pointer}.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;border:none;cursor:pointer;transition:all 0.2s;width:100%}.btn-primary{background:var(--accent);color:white}.btn-primary:hover{background:var(--accent-hover)}.btn-success{background:var(--success);color:white}.btn-success:hover{background:#16a34a}.btn-secondary{background:var(--bg-tertiary);color:var(--text-primary);border:1px solid var(--border)}.btn-secondary:hover{background:var(--bg-hover)}.btn-danger{background:var(--danger);color:white}.btn-sm{padding:8px 14px;font-size:13px}.btn:disabled{opacity:0.5;cursor:not-allowed}.btn-group{display:flex;flex-direction:column;gap:10px}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-title{font-size:28px;font-weight:700}.header-actions{display:flex;gap:12px}.status-bar{background:var(--bg-secondary);border:1px solid var(--border);border-radius:10px;padding:14px 18px;margin-bottom:24px;display:flex;align-items:center;gap:12px}.status-bar.info{border-left:3px solid var(--accent)}.status-bar.success{border-left:3px solid var(--success);background:var(--success-bg)}.status-bar.warning{border-left:3px solid var(--warning);background:var(--warning-bg)}.status-bar.error{border-left:3px solid var(--danger);background:var(--danger-bg)}.status-icon{font-size:18px}.status-text{flex:1;font-size:14px}.progress-container{background:var(--bg-secondary);border:1px solid var(--border);border-radius:10px;padding:18px;margin-bottom:24px;display:none}.progress-container.active{display:block}.progress-header{display:flex;justify-content:space-between;margin-bottom:12px;font-size:14px}.progress-bar{height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--purple));border-radius:4px;transition:width 0.3s}.apt-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px}.apt-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:14px;overflow:hidden;transition:all 0.2s}.apt-card:hover{border-color:var(--accent);transform:translateY(-2px)}.apt-card.selected{border-color:var(--success);box-shadow:0 0 0 1px var(--success)}.apt-card.fail{opacity:0.6}.apt-image{height:160px;background:var(--bg-tertiary);position:relative;overflow:hidden}.apt-image img{width:100%;height:100%;object-fit:cover}.apt-image-placeholder{display:flex;align-items:center;justify-content:center;height:100%;font-size:48px;color:var(--text-muted)}.apt-score{position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.8);padding:6px 12px;border-radius:20px;font-size:13px;font-weight:600}.apt-score.high{color:var(--success)}.apt-score.medium{color:var(--warning)}.apt-score.low{color:var(--danger)}.apt-badges{position:absolute;top:12px;left:12px;display:flex;gap:6px}.badge{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600}.badge-pass{background:var(--success-bg);color:var(--success)}.badge-fail{background:var(--danger-bg);color:var(--danger)}.badge-nofee{background:var(--purple);color:white}.badge-new{background:var(--accent);color:white}.badge-contacted{background:var(--success);color:white}.apt-content{padding:18px}.apt-select{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:14px;border-bottom:1px solid var(--border)}.apt-select input{width:18px;height:18px;accent-color:var(--success)}.apt-select-label{font-size:13px;color:var(--text-secondary)}.apt-address{font-size:16px;font-weight:600;margin-bottom:6px;line-height:1.3}.apt-neighborhood{font-size:13px;color:var(--text-muted);margin-bottom:12px}.apt-rent{font-size:26px;font-weight:700;color:var(--accent);margin-bottom:14px}.apt-rent span{font-size:14px;font-weight:400;color:var(--text-muted)}.apt-budget{background:var(--bg-tertiary);border-radius:8px;padding:12px;margin-bottom:14px}.budget-row{display:flex;justify-content:space-between;font-size:13px;padding:4px 0}.budget-row span:first-child{color:var(--text-muted)}.budget-row span:last-child{color:var(--text-primary);font-weight:500}.budget-row.highlight span:last-child{color:var(--success)}.apt-actions{display:flex;gap:8px}.apt-actions .btn{flex:1;padding:10px}.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}.modal-overlay.active{display:flex}.modal{background:var(--bg-secondary);border:1px solid var(--border);border-radius:16px;width:90%;max-width:560px;max-height:85vh;overflow-y:auto}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border)}.modal-title{font-size:18px;font-weight:600}.modal-close{background:none;border:none;color:var(--text-muted);font-size:24px;cursor:pointer;padding:4px}.modal-close:hover{color:var(--text-primary)}.modal-body{padding:24px}.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:12px;justify-content:flex-end}.modal-footer .btn{width:auto}textarea{width:100%;min-height:200px;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:8px;padding:14px;color:var(--text-primary);font-family:inherit;font-size:14px;resize:vertical;line-height:1.6}textarea:focus{outline:none;border-color:var(--accent)}.empty-state{text-align:center;padding:80px 40px;color:var(--text-muted)}.empty-state-icon{font-size:64px;margin-bottom:20px}.empty-state-title{font-size:20px;font-weight:600;color:var(--text-primary);margin-bottom:8px}.empty-state-text{font-size:14px;max-width:400px;margin:0 auto}@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}.loading{animation:pulse 1.5s infinite}@media(max-width:1024px){.sidebar{width:240px}.main{margin-left:240px}}@media(max-width:768px){.sidebar{position:relative;width:100%;height:auto}.main{margin-left:0}.apt-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo"><div class="logo-icon">üè†</div><div class="logo-text">Apartment Hunter<span>Pro v2.0</span></div></div>
            <div class="sidebar-section"><div class="sidebar-title">Dashboard</div><div class="stats-grid"><div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total Found</div></div><div class="stat-card"><div class="stat-value success" id="stat-passing">0</div><div class="stat-label">Pass 40x</div></div><div class="stat-card"><div class="stat-value purple" id="stat-selected">0</div><div class="stat-label">Selected</div></div><div class="stat-card"><div class="stat-value warning" id="stat-contacted">0</div><div class="stat-label">Contacted</div></div></div></div>
            <div class="sidebar-section"><div class="sidebar-title">Search Filters</div><div class="form-row"><div class="form-group"><label class="form-label">Min Rent</label><input type="number" class="form-input" id="min-rent" value="2400"></div><div class="form-group"><label class="form-label">Max Rent</label><input type="number" class="form-input" id="max-rent" value="3200"></div></div><div class="form-group"><label class="form-label">Your Income</label><input type="number" class="form-input" id="income" value="110000"></div><div class="form-group"><label class="form-label">Max Rent (40x Rule)</label><input type="text" class="form-input" id="max-40x" value="$2,750" disabled style="color:var(--success);"></div></div>
            <div class="sidebar-section"><div class="sidebar-title">Neighborhoods</div><div class="checkbox-list" id="neighborhoods"><div class="checkbox-item"><input type="checkbox" id="n-east-harlem" value="east-harlem" checked><label for="n-east-harlem">East Harlem</label></div><div class="checkbox-item"><input type="checkbox" id="n-yorkville" value="yorkville" checked><label for="n-yorkville">Yorkville</label></div><div class="checkbox-item"><input type="checkbox" id="n-ues" value="upper-east-side" checked><label for="n-ues">Upper East Side</label></div><div class="checkbox-item"><input type="checkbox" id="n-harlem" value="harlem" checked><label for="n-harlem">Harlem</label></div><div class="checkbox-item"><input type="checkbox" id="n-wash-heights" value="washington-heights"><label for="n-wash-heights">Washington Heights</label></div><div class="checkbox-item"><input type="checkbox" id="n-inwood" value="inwood"><label for="n-inwood">Inwood</label></div></div></div>
            <div class="sidebar-section"><div class="sidebar-title">Actions</div><div class="btn-group"><button class="btn btn-primary" id="btn-search" onclick="startSearch()">üîç Search StreetEasy</button><button class="btn btn-success" id="btn-send" onclick="sendInquiries()">üìß Send Inquiries</button><button class="btn btn-secondary" onclick="selectAllPassing()">‚úÖ Select All Passing</button><button class="btn btn-secondary" onclick="exportCSV()">üì• Export CSV</button></div></div>
        </aside>
        <main class="main">
            <div class="header"><h1 class="header-title">Apartments</h1><div class="header-actions"><button class="btn btn-secondary btn-sm" onclick="clearSelection()">Clear Selection</button><button class="btn btn-secondary btn-sm" onclick="refreshList()">‚Üª Refresh</button></div></div>
            <div class="status-bar info" id="status-bar"><span class="status-icon">‚ÑπÔ∏è</span><span class="status-text" id="status-text">Ready to search. Configure filters and click "Search StreetEasy".</span></div>
            <div class="progress-container" id="progress-container"><div class="progress-header"><span id="progress-label">Searching...</span><span id="progress-percent">0%</span></div><div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div></div>
            <div class="apt-grid" id="apt-grid"><div class="empty-state"><div class="empty-state-icon">üè†</div><div class="empty-state-title">No apartments yet</div><div class="empty-state-text">Click "Search StreetEasy" to find apartments matching your criteria.</div></div></div>
        </main>
    </div>
    <div class="modal-overlay" id="modal-inquiry"><div class="modal"><div class="modal-header"><h3 class="modal-title">üìß Inquiry Preview</h3><button class="modal-close" onclick="closeModal('modal-inquiry')">&times;</button></div><div class="modal-body"><p style="color:var(--text-muted);margin-bottom:16px;" id="modal-address"></p><textarea id="modal-message" readonly></textarea></div><div class="modal-footer"><button class="btn btn-secondary btn-sm" onclick="copyMessage()">üìã Copy</button><button class="btn btn-primary btn-sm" onclick="closeModal('modal-inquiry')">Close</button></div></div></div>
    <script>
        let apartments=[];let socket=null;function initSocket(){socket=io();socket.on('connect',()=>{updateStatus('info','Connected to server');loadApartments()});socket.on('disconnect',()=>{updateStatus('error','Disconnected from server')});socket.on('status',(data)=>{updateStatus(data.type||'info',data.message)});socket.on('scrape_started',()=>{document.getElementById('progress-container').classList.add('active');document.getElementById('btn-search').disabled=true});socket.on('scrape_progress',(data)=>{document.getElementById('progress-label').textContent=`Searching ${data.neighborhood}...`;document.getElementById('progress-percent').textContent=`${Math.round(data.progress)}%`;document.getElementById('progress-fill').style.width=`${data.progress}%`});socket.on('listing_found',(data)=>{});socket.on('scrape_complete',(data)=>{document.getElementById('progress-container').classList.remove('active');document.getElementById('btn-search').disabled=false;updateStatus('success',data.message);loadApartments()});socket.on('inquiry_progress',(data)=>{updateStatus('info',`Processing ${data.current}/${data.total}: ${data.apartment}`)});socket.on('inquiry_ready',(data)=>{updateStatus('warning',`Review and submit: ${data.address}`)});socket.on('inquiries_complete',(data)=>{updateStatus('success',data.message);document.getElementById('btn-send').disabled=false;loadApartments()})}async function loadApartments(){try{const res=await fetch('/api/apartments');const data=await res.json();apartments=data.apartments;updateStats(data.stats);renderApartments()}catch(e){updateStatus('error','Failed to load apartments')}}async function toggleSelect(id){await fetch(`/api/apartments/${id}/select`,{method:'POST'});loadApartments()}async function deleteApartment(id){if(!confirm('Delete this apartment?'))return;await fetch(`/api/apartments/${id}`,{method:'DELETE'});loadApartments()}async function previewInquiry(id){const res=await fetch(`/api/apartments/${id}/inquiry`);const data=await res.json();document.getElementById('modal-address').textContent=data.apartment.address;document.getElementById('modal-message').value=data.message;openModal('modal-inquiry')}function startSearch(){const neighborhoods=Array.from(document.querySelectorAll('#neighborhoods input:checked')).map(el=>el.value);if(neighborhoods.length===0){updateStatus('error','Select at least one neighborhood');return}socket.emit('start_scrape',{neighborhoods,min_rent:parseInt(document.getElementById('min-rent').value),max_rent:parseInt(document.getElementById('max-rent').value)})}function sendInquiries(){const selected=apartments.filter(a=>a.selected);if(selected.length===0){updateStatus('error','Select apartments first');return}if(!confirm(`Send inquiries to ${selected.length} apartments?`))return;document.getElementById('btn-send').disabled=true;socket.emit('send_inquiries',{apartment_ids:selected.map(a=>a.id)})}function selectAllPassing(){const passing=apartments.filter(a=>a.passes_40x&&!a.selected);passing.forEach(apt=>{fetch(`/api/apartments/${apt.id}/select`,{method:'POST'})});setTimeout(loadApartments,500)}function clearSelection(){apartments.filter(a=>a.selected).forEach(apt=>{fetch(`/api/apartments/${apt.id}/select`,{method:'POST'})});setTimeout(loadApartments,500)}function exportCSV(){window.location.href='/api/export'}function refreshList(){loadApartments()}function copyMessage(){const textarea=document.getElementById('modal-message');textarea.select();document.execCommand('copy');updateStatus('success','Copied to clipboard!')}function updateStatus(type,message){const bar=document.getElementById('status-bar');const text=document.getElementById('status-text');bar.className=`status-bar ${type}`;text.textContent=message;const icons={info:'‚ÑπÔ∏è',success:'‚úÖ',warning:'‚ö†Ô∏è',error:'‚ùå'};bar.querySelector('.status-icon').textContent=icons[type]||'‚ÑπÔ∏è'}function updateStats(stats){document.getElementById('stat-total').textContent=stats.total;document.getElementById('stat-passing').textContent=stats.passing;document.getElementById('stat-selected').textContent=stats.selected;document.getElementById('stat-contacted').textContent=stats.contacted}function openModal(id){document.getElementById(id).classList.add('active')}function closeModal(id){document.getElementById(id).classList.remove('active')}function getScoreClass(score){if(score>=70)return'high';if(score>=40)return'medium';return'low'}function renderApartments(){const grid=document.getElementById('apt-grid');if(apartments.length===0){grid.innerHTML=`<div class="empty-state"><div class="empty-state-icon">üè†</div><div class="empty-state-title">No apartments yet</div><div class="empty-state-text">Click "Search StreetEasy" to find apartments matching your criteria.</div></div>`;return}grid.innerHTML=apartments.map(apt=>`<div class="apt-card ${apt.selected?'selected':''} ${!apt.passes_40x?'fail':''}"><div class="apt-image">${apt.image_url?`<img src="${apt.image_url}" alt="${apt.address}">`:'<div class="apt-image-placeholder">üè†</div>'}<div class="apt-score ${getScoreClass(apt.score)}">${apt.score} pts</div><div class="apt-badges"><span class="badge ${apt.passes_40x?'badge-pass':'badge-fail'}">${apt.passes_40x?'‚úì 40x':'‚úó 40x'}</span>${apt.no_fee?'<span class="badge badge-nofee">No Fee</span>':''}${apt.status==='contacted'?'<span class="badge badge-contacted">Contacted</span>':''}${apt.status==='new'?'<span class="badge badge-new">New</span>':''}</div></div><div class="apt-content"><div class="apt-select"><input type="checkbox" ${apt.selected?'checked':''} onchange="toggleSelect('${apt.id}')"><span class="apt-select-label">Select for inquiry</span></div><div class="apt-address">${apt.address}</div><div class="apt-neighborhood">üìç ${apt.neighborhood}</div><div class="apt-rent">$${apt.rent.toLocaleString()}<span>/mo</span></div><div class="apt-budget"><div class="budget-row"><span>Dining Out</span><span>$${apt.budget?.dining_out||0}/mo</span></div><div class="budget-row highlight"><span>Savings</span><span>$${apt.budget?.savings||0}/mo</span></div></div><div class="apt-actions"><button class="btn btn-secondary btn-sm" onclick="window.open('${apt.url}','_blank')">üîó View</button><button class="btn btn-secondary btn-sm" onclick="previewInquiry('${apt.id}')">üìß Preview</button><button class="btn btn-secondary btn-sm" onclick="deleteApartment('${apt.id}')">üóëÔ∏è</button></div></div></div>`).join('')}document.getElementById('income').addEventListener('input',(e)=>{const income=parseInt(e.target.value)||0;const max40x=Math.floor(income/40);document.getElementById('max-40x').value=`$${max40x.toLocaleString()}`});initSocket();
    </script>
</body>
</html>
